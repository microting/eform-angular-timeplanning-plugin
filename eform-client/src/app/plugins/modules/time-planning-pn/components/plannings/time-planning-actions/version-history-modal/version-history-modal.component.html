<div class="modal-header">
  <h4 class="modal-title">Version History</h4>
  <button type="button" class="close" (click)="close()" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<div class="modal-body" *ngIf="!loading && versionHistory">
  <div class="version-history-container">
    <div class="versions-panel" [class.with-side-panel]="selectedGpsCoordinate || selectedSnapshot">
      <div *ngFor="let version of versionHistory.versions" class="version-section">
        <h5>
          {{ formatDateTime(version.updatedAt) }} Values changed
          <span *ngIf="version.updatedByUserId">by User ID: {{ version.updatedByUserId }}</span>
        </h5>
        
        <table class="table table-bordered table-sm">
          <thead>
            <tr>
              <th>Variable</th>
              <th>From value</th>
              <th>To value</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let change of version.changes">
              <td>{{ getFieldDisplayName(change.fieldName) }}</td>
              <td>{{ change.fromValue }}</td>
              <td>
                <ng-container *ngIf="change.fieldType === 'gps'">
                  <a href="javascript:void(0)" (click)="onGpsClick(change)">
                    View on Maps ({{ change.latitude }}, {{ change.longitude }})
                  </a>
                </ng-container>
                <ng-container *ngIf="change.fieldType === 'snapshot'">
                  <a href="javascript:void(0)" (click)="onSnapshotClick(change)">
                    View Snapshot
                  </a>
                </ng-container>
                <ng-container *ngIf="change.fieldType === 'standard'">
                  {{ change.toValue }}
                </ng-container>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <div *ngIf="versionHistory.versions.length === 0" class="no-versions">
        <p>No version history available.</p>
      </div>
    </div>
    
    <div class="side-panel" *ngIf="selectedGpsCoordinate || selectedSnapshot">
      <div class="side-panel-header">
        <button type="button" class="close" (click)="closePanel()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="side-panel-content">
        <div *ngIf="selectedGpsCoordinate && mapUrl" class="map-container">
          <iframe 
            [src]="mapUrl" 
            width="100%" 
            height="100%" 
            style="border:0" 
            allowfullscreen>
          </iframe>
        </div>
        <div *ngIf="selectedSnapshot && snapshotUrl" class="snapshot-container">
          <img [src]="snapshotUrl" alt="Snapshot" class="snapshot-image" />
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-body" *ngIf="loading">
  <div class="text-center">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="close()">Close</button>
</div>
